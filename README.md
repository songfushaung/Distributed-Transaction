# Distributed-Transaction
分布式事物
     1.概念:
     就是一次大的操作由不同的小操作组成，这些小的操作分布在不同的服务器上，且属于不同的应用，分布式事务需要保证这些小操作要么全部成功，要么全部失败。
     本质上来说，分布式事务就是为了保证不同数据源的数据一致性。
     
     2.分布式事物解决方案 可以使用全局事物2pc（两段提交协议）、3pc(三段提交协议)，tcc补偿机制、提供回滚接口、分布式数据库 MQ解决
     
     3.事物特性(acid)
	原子性（A）
	在整个事务中的所有操作，要么全部完成，要么全部不做，没有中间状态。对于事务在执行中发生错误，所有的操作都会被回滚。
	一致性（C）
	事务执行之前和执行之后数据库都必须处于一致性状态。
	隔离性（I）
	所谓的隔离性就是说，事务与事务之间不会互相影响。
	持久性（D）
	事务完成提交了，那么事务对数据所做的变更就完全保存在了数据库中。
	
    4.事物隔离级别
      脏读:一个事务处理过程里读取了另一个未提交的事务中的数据。
      (事务T1读取到事务T2修改了但是还未提交的数据，之后事务T2又回滚其更新操作，导致事务T1读到的是脏数据。)
      不可重复读是:数据库中的某个数据，一个事务范围内多次查询却返回了不同的数据值
      (事务T1读取某个数据后，事务T2对其做了修改，当事务T1再次读该数据时得到与前一次不同的值。)
      更新丢失：两事务同时更新，一个失败回滚覆盖另一个事务的更新。
      幻读:事务T1读取在读取某范围数据时，事务T2又插入一条数据，当事务T1查看数据这个范围数据时发现不一样了
      不可重复读和脏读的区别：脏读是某一事务读取了另一个事务未提交的脏数据，而不可重复读则是读取了前一事务提交的数据。
      
     5.分布式的CPA理论:
       数据一致性(consistency)：如果系统对一个写操作返回成功，那么之后的读请求都必须读到这个新数据；如果返回失败，
       那么所有读操作都不能读到这个数据
       服务可用性(availability)：所有读写请求在一定时间内得到响应，可终止、不会一直等待
       分区容错性(partition-tolerance)：在网络分区的情况下，被分隔的节点仍能正常对外服务
       一个分布式系统不可能同时满足一致性、可用性和分区容错性这三个基本需求，最多只能同时满足其中两项
       
      6.base理论:
       BASE是Basically Available（基本可用）、Soft state（软状态）和Eventually consistent（最终一致性）三个短语的缩写,
       是基于CAP定理演化而来 就是即使无法做到强一致性，但每个应用都可以根据自身业务特点，采用适当的方式来使系统达到最终一致性。
          基本可用：指分布式系统在出现故障的时候，允许损失部分可用性.如作服务降级(使其他不太重要的服务进行暂停或等待)
          软状态：软状态是指允许系统存在中间状态，并且该中间状态不会影响系统整体可用性。
	  最终一致性：系统中的所有数据副本经过一定时间后，最终能够达到一致的状态，不需要实时保证系统数据的强一致性。
	  
      7.柔性事务满足BASE理论:分为两阶段型，补偿型，异步确保型。最大努力通知型几种。
        刚性事务满足ACID理论
	
     8.分析产生分布式事物---CPA BASE  柔性事务 刚性事务---在解决分布式事物
     
     9.全局事物:多个数据库可能需要共同完成一个工作，这个工作即是一个全局事务
     
     10.本地事物:
     11.XA接口:XA由协调者和参与者共同完成。负责各个本地资源的提交和回滚。
     
     12.2pc:俩段提交,XA优化了2pc分为准备阶段、
            提交阶段 准备阶段协调者给参与者发送预备通知,参与者回复协调者(数据库操作完成但没有提交事物)
            提交阶段,收到回复协调者在发送确认操作(回滚或提交事物)
	    注意:提交阶段有一方未及时响应会一致等待,如果一方回复失败则直接回滚
	    缺点:阻塞延迟 数据不一致
     13.3pc:二阶段提交（2PC）的改进版本。3PC把2PC的准备阶段再次一分为二，这样三阶段提交就有CanCommit、PreCommit、DoCommit三个阶段.引入超时机制
     
     14.mq:重试机制(会有重复消费问题:全局id+日志记录)和补偿机制(定时job任务实现补偿机制)
